package Algorithm.leetcode.leetcode.editor.cn;
//ç»™å®šä¸€ä¸ªåªåŒ…å« '(' å’Œ ')' çš„å­—ç¬¦ä¸²ï¼Œæ‰¾å‡ºæœ€é•¿çš„åŒ…å«æœ‰æ•ˆæ‹¬å·çš„å­ä¸²çš„é•¿åº¦ã€‚
//
// ç¤ºä¾‹ 1: 
//
// è¾“å…¥: "(()"
//è¾“å‡º: 2
//è§£é‡Š: æœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²ä¸º "()"
// 
//
// ç¤ºä¾‹ 2: 
//
// è¾“å…¥: ")()())"
//è¾“å‡º: 4
//è§£é‡Š: æœ€é•¿æœ‰æ•ˆæ‹¬å·å­ä¸²ä¸º "()()"
// 
// Related Topics å­—ç¬¦ä¸² åŠ¨æ€è§„åˆ’ 
// ğŸ‘ 1085 ğŸ‘ 0


import java.util.Deque;
import java.util.LinkedList;
import java.util.Stack;

//leetcode submit region begin(Prohibit modification and deletion)
class Solution {
    // é¢˜ç›®é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/longest-valid-parentheses/
    public int longestValidParentheses(String s) {
        // æ—¶é—´å¤æ‚åº¦ï¼šO(N),ä¸€å±‚forå¾ªç¯
        // ç©ºé—´å¤æ‚åº¦ï¼šO(N),ç”¨äº†ä¸€ä¸ªæ ˆ
//        return func1(s);

        // æ—¶é—´å¤æ‚åº¦ï¼šO(N),ä¸€å±‚forå¾ªç¯
        // ç©ºé—´å¤æ‚åº¦ï¼šO(N),ç”¨äº†ä¸€ä¸ªæ ˆ
        return func2(s);

    }

    /**
     * æ€è·¯äºŒï¼šåŠ¨æ€è§„åˆ’
     *
     * @param s åŸå§‹å­—ç¬¦ä¸²
     * @return æœ€å¤§æœ‰æ•ˆæ‹¬å·æ•°
     */
    private int func2(String s) {
        // 1. æ‰¾é‡å¤æ€§ã€‚
        // 2. å®šä¹‰çŠ¶æ€æ•°ç»„ï¼šdp[i]è¡¨ç¤ºä»¥iç»“å°¾çš„å­—ç¬¦ä¸²çš„æœ€å¤§æœ‰æ•ˆæ‹¬å·æ•°é‡
        // 3. å¦‚æœå½“å‰ä¸‹æ ‡è¡¨ç¤ºçš„å­—ç¬¦æ˜¯')',å¹¶ä¸”ä»–çš„å‰ä¸€ä¸ªæ˜¯å·¦æ‹¬å·ã€‚é‚£ä¹ˆdp[i] = dp[i - 2] + 2
        //    åä¹‹ï¼Œå¦‚æœä»–çš„å‰ä¸€ä¸ªä¸æ˜¯å·¦æ‹¬å·ï¼Œè€Œæ˜¯å³æ‹¬å·ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Š
        //   å¦‚æœs[i - dp[i - 1] - 1]ä»£è¡¨çš„å­—ç¬¦æ˜¯å·¦æ‹¬å·ã€‚å¦‚****(()())è¿™ç§æƒ…å†µã€‚
        //   dp[i] = dp[i - 1] + dp[i - dp[i - 1] - 2] + 2ã€‚å…¶ä¸­dp[i - 1]æŒ‡çš„æ˜¯()()è¿™ä¸¤ä¸ªæ‹¬å·
        //   çš„é•¿åº¦ï¼Œå¯ä»¥çœ‹åˆ°çš„(()())æœ€å¤–é¢çš„ä¸¤ä¸ªæ‹¬å·å°±æ˜¯ 2ï¼Œ è€Œ***ä»£è¡¨çš„å°±æ˜¯dp[i-dp[i-1]-2]

        // è·å–å­—ç¬¦ä¸²é•¿åº¦
        int length = s.length();
        // ç”³è¯·dpæ•°ç»„
        int[] dp = new int[length];
        // å®šä¹‰æœ€å¤§å€¼
        int max = 0;

        // å¾ªç¯dp
        for (int i = 1; i < length; i++) {
            if (s.charAt(i) == ')') {
                if (s.charAt(i - 1) == '(') {
                    dp[i] = dp[Math.max(i - 2, 0)] + 2;
                } else if (i - dp[i - 1] > 0 && s.charAt(i - dp[i - 1] - 1) == '(') {
                    dp[i] = dp[i - 1] + dp[Math.max(i - dp[i - 1] - 2, 0)] + 2;
                }
                max = Math.max(dp[i], max);
            }
        }

        return max;
    }

    /**
     * æ€è·¯ä¸€ï¼šæ ˆ
     *
     * @param s åŸå­—ç¬¦ä¸²
     * @return æœ€å¤§æœ‰æ•ˆæ‹¬å·æ•°
     */
    private int func1(String s) {
        // ç”¨æ ˆå»æ¨¡æ‹Ÿ
        // å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå­—ç¬¦æ•°ç»„
        char[] sA = s.toCharArray();
        // å®šä¹‰è¿”å›ç»“æœ
        int res = 0;
        // è·å–å­—ç¬¦ä¸²é•¿åº¦
        int length = s.length();

        // ç”³è¯·ä¸€ä¸ªæ ˆ
        Deque<Integer> stack = new LinkedList<>();
        // é˜²æ­¢ç¬¬ä¸€ä¸ªæ”¾è¿›å»çš„æœ‰æ‹¬å·çš„æƒ…å†µ
        stack.push(-1);

        // éå†å­—ç¬¦ä¸²
        for (int i = 0; i < length; i++) {
            // å¦‚æœé‡åˆ°å·¦æ‹¬å·ï¼Œå°†å®ƒçš„ä¸‹æ ‡å…¥æ ˆå³å¯
            if (sA[i] == '(') {
                stack.push(i);
            } else {
                // å¦‚æœé‡åˆ°å³æ‹¬å·
                // 1. å…ˆå‡ºæ ˆä¸€ä¸ªå…ƒç´ 
                stack.pop();
                // 2. å¦‚æœæ­¤æ—¶æ ˆä¸ºç©ºï¼Œè¯æ˜å‡ºæ‰çš„æ˜¯æˆ‘ä»¬æœ€å¼€å§‹pushè¿›å»çš„-1ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å½“å‰å³æ‹¬å·çš„ä¸‹æ ‡å…¥æ ˆ
                // 3. å¦‚æœæ ˆä¸ä¸ºç©ºï¼Œè¯æ˜å½“å‰å³æ‹¬å·è¢«åŒ¹é…äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬è®¡ç®—æ¯”è¾ƒä¸€ä¸‹ä»¥å‰çš„æœ€å¤§å€¼ä»¥åŠå½“å‰å³æ‹¬å·ä¸‹æ ‡å’Œæ ˆé¡¶çš„å·®å€¼ï¼Œå¾—å‡ºæœ€å¤§å€¼å³å¯
                if (stack.isEmpty()) {
                    stack.push(i);
                } else {
                    res = Math.max(res, i - stack.peek());
                }
            }
        }

        return res;
    }
}
//leetcode submit region end(Prohibit modification and deletion)
