package Algorithm.leetcode.leetcode.editor.cn;
//ç»™å®šä¸€ä¸ªæ•°ç»„ nums ï¼Œå¦‚æœ i < j ä¸” nums[i] > 2*nums[j] æˆ‘ä»¬å°±å°† (i, j) ç§°ä½œä¸€ä¸ªé‡è¦ç¿»è½¬å¯¹ã€‚
//
// ä½ éœ€è¦è¿”å›ç»™å®šæ•°ç»„ä¸­çš„é‡è¦ç¿»è½¬å¯¹çš„æ•°é‡ã€‚ 
//
// ç¤ºä¾‹ 1: 
//
// 
//è¾“å…¥: [1,3,2,3,1]
//è¾“å‡º: 2
// 
//
// ç¤ºä¾‹ 2: 
//
// 
//è¾“å…¥: [2,4,3,5,1]
//è¾“å‡º: 3
// 
//
// æ³¨æ„: 
//
// 
// ç»™å®šæ•°ç»„çš„é•¿åº¦ä¸ä¼šè¶…è¿‡50000ã€‚ 
// è¾“å…¥æ•°ç»„ä¸­çš„æ‰€æœ‰æ•°å­—éƒ½åœ¨32ä½æ•´æ•°çš„è¡¨ç¤ºèŒƒå›´å†…ã€‚ 
// 
// Related Topics æ’åº æ ‘çŠ¶æ•°ç»„ çº¿æ®µæ ‘ äºŒåˆ†æŸ¥æ‰¾ åˆ†æ²»ç®—æ³• 
// ğŸ‘ 241 ğŸ‘ 0


//leetcode submit region begin(Prohibit modification and deletion)
class Solution {
    // é¢˜ç›®é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/reverse-pairs/
    public int reversePairs(int[] nums) {
        if (nums.length == 0 || nums == null) {
            return 0;
        }

        return mergeSort(nums, 0, nums.length - 1);
    }

    private int mergeSort(int[] nums, int start, int end) {
        // é€’å½’ç»ˆæ­¢æ¡ä»¶
        if (start >= end) {
            return 0;
        }

        // è®¡ç®—å‡ºä¸­é—´èŠ‚ç‚¹
        int mid = (start + end) >> 1;
        // å½“å‰å±‚ç¿»è½¬å¯¹çš„æ•°é‡, åˆå§‹åŒ–ä¸º0
        // ä½†æ˜¯é€»è¾‘ä¸Šï¼Œä»–ç­‰äºï¼Œå·¦åŠè¾¹ç¿»è½¬å¯¹çš„æ•°é‡ + å³åŠè¾¹ç¿»è½¬å¯¹çš„æ•°é‡ + å·¦å³åˆå¹¶èµ·æ¥çš„ç¿»è½¬å¯¹çš„æ•°é‡
        // ä¸¾ä¸ªä¾‹å­è¯´ï¼š2 1 3 4 7 8 5 6åè½¬å¯¹çš„æ•°é‡å°±ç­‰äº
        //ï¼ˆ2 1 3 4ï¼‰ç¿»è½¬å¯¹çš„æ•°é‡ + ï¼ˆ7 8 5 6)ç¿»è½¬å¯¹çš„æ•°é‡ + ï¼ˆ2 1 3 4ï¼‰ä¸ï¼ˆ7 8 5 6ï¼‰ä¹‹é—´ç¿»è½¬å¯¹çš„æ•°é‡
        int cnt = 0;

        cnt = mergeSort(nums, start, mid) + mergeSort(nums, mid + 1, end);

        // ä¸‹é¢å°±æ˜¯è¦å¼€å§‹mergeçš„æ“ä½œï¼Œä¸€émergeä¸€è¾¹å¾—å‡ºå½“å‰å±‚å·¦åŠè¾¹ä¸å³åŠè¾¹çš„ç¿»è½¬å¯¹æ•°é‡
        int l = start, i = start, r = end, c = 0;
        // ä¸´æ—¶æ•°ç»„è£…æ’å¥½åºçš„æ•°å­—
        int[] temp = new int[end - start + 1];
        // éå†çœ‹å‰åŠè¾¹å’ŒååŠè¾¹åˆ°åº•æœ‰å¤šå°‘ç¿»è½¬å¯¹
        for (int j = mid + 1; j <= end; j++) {
            // è®°å½•å·¦åŠè¾¹ä»å·¦åˆ°å³æœ‰å¤šå°‘ä¸ªæ¯”2*nums[j]å°çš„ï¼Œç›´åˆ°é‡åˆ°æ¯”ä»–å¤§çš„
            // å› ä¸ºå·¦åŠè¾¹å’Œå³åŠè¾¹éƒ½æ˜¯æ’å¥½åºçš„ï¼Œå½“å·¦åŠè¾¹é‡åˆ°äº†ä¸€ä¸ªæ¯”å½“å‰nums[j]*2å¤§çš„
            // å·¦åŠè¾¹åé¢çš„ä¹Ÿä¸€å®šæ¯”å½“å‰çš„nums[j] * 2å¤§ï¼Œå°±ä¸ç”¨å†å»åˆ¤æ–­äº†ã€‚
            while (i <= mid && nums[i] <= 2 * (long)nums[j]) {
                i++;
            }
            // ç›®çš„æ˜¯å°†å·¦åŠè¾¹å’Œå³åŠè¾¹åˆå¹¶èµ·æ¥æ’åºè®°å½•åˆ°ä¸´æ—¶æ•°ç»„ä¸­
            // è¿™ä¸ªå°±æ˜¯å½’å¹¶æ’åºçš„éƒ¨åˆ†
            while (l <= mid && nums[l] <= nums[j]) {
                temp[c++] = nums[l++];
            }
            // å½“ä¸Šé¢å¾ªç¯èµ°å®Œçš„æ—¶å€™ï¼Œå·¦åŠè¾¹ä¸­æ¯”å³åŠè¾¹å½“å‰æ•°å­—å°çš„æ•°å­—éƒ½å·²ç»åŠ å…¥åˆ°ä¸´æ—¶æ•°ç»„äº†
            // æ‰€ä»¥å°†å½“å‰å³åŠè¾¹æ•°å­—åŠ å…¥åˆ°æ•°ç»„ä¸­
            temp[c++] = nums[j];
            // æ›´æ–°åè½¬å¯¹æ•°é‡ï¼Œç”±äºiæ˜¯æœ‰å°‘ä¸ªå°äºç­‰äº2*nums[j]çš„ï¼Œæ‰€ä»¥mid - i + 1å°±æ˜¯æœ‰å¤šå°‘å¤§äºä»–çš„
            cnt += mid - i + 1;
        }

        // forå¾ªç¯å®Œäº†åªèƒ½ä¿è¯å³åŠè¾¹è‚¯å®šéƒ½åŠ å…¥æ•°ç»„äº†ï¼Œå·¦åŠè¾¹ä¸ä¸€å®š
        while (l <= mid) {
            temp[c++] = nums[l++];
        }
        // å°†tempèµ‹å€¼ç»™nums
        for (int p = 0; p < temp.length; p++) {
            nums[start + p] = temp[p];
        }

        return cnt;
    }
}
//leetcode submit region end(Prohibit modification and deletion)
